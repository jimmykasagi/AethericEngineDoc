<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aetheric Engine Monitor</title>
    <style>
        /* AI-Assisted: CSS styling for Aetheric Engine monitoring interface */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #2c1810, #4a3420);
            color: #e8d5b7;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #8b6914;
            padding-bottom: 20px;
        }

        .header h1 {
            color: #ffd700;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 10px;
        }

        .header p {
            color: #cd853f;
            font-style: italic;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(145deg, #8b6914, #cd853f);
            border: none;
            color: #2c1810;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-family: inherit;
            transition: all 0.3s;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 3px 3px 8px rgba(0,0,0,0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .status-panel {
            background: rgba(0,0,0,0.3);
            border: 2px solid #8b6914;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .status-item {
            background: rgba(255,215,0,0.1);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ffd700;
        }

        .status-item h3 {
            color: #ffd700;
            margin-bottom: 5px;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .status-item .value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .connected { color: #90EE90; }
        .disconnected { color: #FFB6C1; }
        .collecting { color: #87CEEB; }
        .stopped { color: #DDA0DD; }

        .log-panel {
            background: rgba(0,0,0,0.5);
            border: 2px solid #8b6914;
            border-radius: 10px;
            padding: 20px;
            height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .log-panel h2 {
            color: #ffd700;
            margin-bottom: 15px;
            border-bottom: 1px solid #8b6914;
            padding-bottom: 5px;
        }

        .log-entry {
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 4px;
            border-left: 3px solid;
            font-size: 0.9rem;
        }

        .log-status { border-left-color: #87CEEB; background: rgba(135,206,235,0.1); }
        .log-ascii { border-left-color: #90EE90; background: rgba(144,238,144,0.1); }
        .log-binary { border-left-color: #FFB6C1; background: rgba(255,182,193,0.1); }
        .log-error { border-left-color: #FF6347; background: rgba(255,99,71,0.1); }
        .log-statistics { border-left-color: #DDA0DD; background: rgba(221,160,221,0.1); }

        .timestamp {
            color: #cd853f;
            font-size: 0.8rem;
            margin-right: 10px;
        }

        .message-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .message-panel {
            background: rgba(0,0,0,0.3);
            border: 2px solid #8b6914;
            border-radius: 10px;
            padding: 20px;
        }

        .message-panel h3 {
            color: #ffd700;
            margin-bottom: 15px;
            text-align: center;
        }

        .message-sample {
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.8rem;
            margin-bottom: 10px;
            border-left: 3px solid;
            word-break: break-all;
        }

        .ascii-sample { border-left-color: #90EE90; }
        .binary-sample { border-left-color: #FFB6C1; }

        .progress-bar {
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 20px;
        }

        .progress-fill {
            background: linear-gradient(90deg, #8b6914, #ffd700);
            height: 20px;
            border-radius: 5px;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #2c1810;
            font-weight: bold;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .message-details {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 200px;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öôÔ∏è The Aetheric Engine ‚öôÔ∏è</h1>
            <p>In the smog-choked skies of Oshikai, the Engine hums with ancient mysteries...</p>
        </div>

        <div class="controls">
            <button class="btn" id="connectBtn">Connect to AE</button>
            <button class="btn" id="disconnectBtn" disabled>Disconnect</button>
            <button class="btn" id="resetBtn">Reset</button>
            <button class="btn" id="clearLogBtn">Clear Log</button>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressBar" style="width: 0%">0 / 600 messages</div>
        </div>

        <div class="status-panel">
            <div class="status-grid">
                <div class="status-item">
                    <h3>Connection</h3>
                    <div class="value" id="connectionStatus">Disconnected</div>
                </div>
                <div class="status-item">
                    <h3>Collection</h3>
                    <div class="value" id="collectionStatus">Stopped</div>
                </div>
                <div class="status-item">
                    <h3>Total Messages</h3>
                    <div class="value" id="totalMessages">0</div>
                </div>
                <div class="status-item">
                    <h3>ASCII Messages</h3>
                    <div class="value" id="asciiMessages">0</div>
                </div>
                <div class="status-item">
                    <h3>Binary Messages</h3>
                    <div class="value" id="binaryMessages">0</div>
                </div>
                <div class="status-item">
                    <h3>Errors</h3>
                    <div class="value" id="errorCount">0</div>
                </div>
            </div>
        </div>

        <div class="message-details">
            <div class="message-panel">
                <h3>Latest ASCII Message</h3>
                <div class="message-sample ascii-sample" id="latestAscii">No ASCII messages yet...</div>
            </div>
            <div class="message-panel">
                <h3>Latest Binary Message</h3>
                <div class="message-sample binary-sample" id="latestBinary">No binary messages yet...</div>
            </div>
        </div>

        <div class="log-panel">
            <h2>üìú Activity Log</h2>
            <div id="logContainer">
                <div class="log-entry log-status">
                    <span class="timestamp">--:--:--</span>
                    <span>Aetheric Engine Monitor initialized. Ready to connect...</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // AI-Assisted: JavaScript for Aetheric Engine WebSocket client interface
        class AethericEngineMonitor {
            constructor() {
                this.ws = null;
                this.isConnected = false;
                this.stats = {
                    totalMessages: 0,
                    asciiMessages: 0,
                    binaryMessages: 0,
                    errors: 0
                };
                
                this.initializeElements();
                this.bindEvents();
                this.connectWebSocket();
            }

            initializeElements() {
                this.elements = {
                    connectBtn: document.getElementById('connectBtn'),
                    disconnectBtn: document.getElementById('disconnectBtn'),
                    resetBtn: document.getElementById('resetBtn'),
                    clearLogBtn: document.getElementById('clearLogBtn'),
                    progressBar: document.getElementById('progressBar'),
                    connectionStatus: document.getElementById('connectionStatus'),
                    collectionStatus: document.getElementById('collectionStatus'),
                    totalMessages: document.getElementById('totalMessages'),
                    asciiMessages: document.getElementById('asciiMessages'),
                    binaryMessages: document.getElementById('binaryMessages'),
                    errorCount: document.getElementById('errorCount'),
                    latestAscii: document.getElementById('latestAscii'),
                    latestBinary: document.getElementById('latestBinary'),
                    logContainer: document.getElementById('logContainer')
                };
            }

            bindEvents() {
                this.elements.connectBtn.addEventListener('click', () => this.startCollection());
                this.elements.disconnectBtn.addEventListener('click', () => this.stopCollection());
                this.elements.resetBtn.addEventListener('click', () => this.resetCollection());
                this.elements.clearLogBtn.addEventListener('click', () => this.clearLog());
            }

            connectWebSocket() {
                try {
                    this.ws = new WebSocket('ws://localhost:8081');
                    
                    this.ws.onopen = () => {
                        this.log('status', 'WebSocket connected to Aetheric Engine server');
                    };

                    this.ws.onmessage = (event) => {
                        const message = JSON.parse(event.data);
                        this.handleMessage(message);
                    };

                    this.ws.onclose = () => {
                        this.log('error', 'WebSocket connection closed');
                        setTimeout(() => this.connectWebSocket(), 5000);
                    };

                    this.ws.onerror = (error) => {
                        this.log('error', 'WebSocket error: ' + error.message);
                    };
                } catch (error) {
                    this.log('error', 'Failed to connect WebSocket: ' + error.message);
                }
            }

            handleMessage(message) {
                switch (message.type) {
                    case 'status':
                        this.handleStatusMessage(message.data);
                        break;
                    case 'ascii':
                        this.handleAsciiMessage(message.data);
                        break;
                    case 'binary':
                        this.handleBinaryMessage(message.data);
                        break;
                    case 'statistics':
                        this.handleStatistics(message.data);
                        break;
                    case 'error':
                        this.handleError(message.data);
                        break;
                    case 'reset':
                        this.handleReset(message.data);
                        break;
                    default:
                        console.log('Unknown message type:', message.type);
                }
            }

            handleStatusMessage(data) {
                if (typeof data === 'object') {
                    this.isConnected = data.connected || false;
                    this.updateConnectionStatus(this.isConnected);
                    this.updateCollectionStatus(data.collecting || false);
                    
                    if (data.stats) {
                        this.updateStatistics(data.stats);
                    }
                }
                
                const statusText = typeof data === 'string' ? data : data.message || 'Status update';
                this.log('status', statusText);
            }

            handleAsciiMessage(data) {
                this.stats.asciiMessages = data.count || this.stats.asciiMessages + 1;
                this.stats.totalMessages = this.stats.asciiMessages + this.stats.binaryMessages;
                
                this.updateStatistics(this.stats);
                this.updateProgress();
                
                this.elements.latestAscii.textContent = `Raw: ${data.raw}\nPayload: "${data.payload}"`;
                this.log('ascii', `ASCII message #${data.count}: "${data.payload}"`);
            }

            handleBinaryMessage(data) {
                this.stats.binaryMessages = data.count || this.stats.binaryMessages + 1;
                this.stats.totalMessages = this.stats.asciiMessages + this.stats.binaryMessages;
                
                this.updateStatistics(this.stats);
                this.updateProgress();
                
                const truncatedPayload = data.payloadHex.length > 32 ? 
                    data.payloadHex.substring(0, 32) + '...' : data.payloadHex;
                this.elements.latestBinary.textContent = 
                    `Header: ${data.headerHex}\nSize: ${data.size} bytes\nPayload: ${truncatedPayload}`;
                this.log('binary', `Binary message #${data.count}: ${data.headerHex}, ${data.size} bytes`);
            }

            handleStatistics(data) {
                this.stats = { ...this.stats, ...data };
                this.updateStatistics(data);
                this.updateProgress();
                this.log('statistics', 
                    `Stats: ${data.totalMessages || 0} total, ${data.asciiMessages || 0} ASCII, ${data.binaryMessages || 0} binary`);
            }

            handleError(data) {
                this.stats.errors = (this.stats.errors || 0) + 1;
                this.elements.errorCount.textContent = this.stats.errors;
                this.log('error', data);
            }

            handleReset(data) {
                this.stats = {
                    totalMessages: 0,
                    asciiMessages: 0,
                    binaryMessages: 0,
                    errors: 0
                };
                this.updateStatistics(this.stats);
                this.updateProgress();
                this.elements.latestAscii.textContent = 'No ASCII messages yet...';
                this.elements.latestBinary.textContent = 'No binary messages yet...';
                this.log('status', data);
            }

            updateConnectionStatus(connected) {
                this.isConnected = connected;
                this.elements.connectionStatus.textContent = connected ? 'Connected' : 'Disconnected';
                this.elements.connectionStatus.className = 'value ' + (connected ? 'connected' : 'disconnected');
                
                this.elements.connectBtn.disabled = connected;
                this.elements.disconnectBtn.disabled = !connected;
            }

            updateCollectionStatus(collecting) {
                this.elements.collectionStatus.textContent = collecting ? 'Collecting' : 'Stopped';
                this.elements.collectionStatus.className = 'value ' + (collecting ? 'collecting' : 'stopped');
            }

            updateStatistics(stats) {
                this.elements.totalMessages.textContent = stats.totalMessages || 0;
                this.elements.asciiMessages.textContent = stats.asciiMessages || 0;
                this.elements.binaryMessages.textContent = stats.binaryMessages || 0;
                this.elements.errorCount.textContent = stats.errors || 0;
            }

            updateProgress() {
                const total = this.stats.totalMessages || 0;
                const target = 600;
                const percentage = Math.min((total / target) * 100, 100);
                
                this.elements.progressBar.style.width = percentage + '%';
                this.elements.progressBar.textContent = `${total} / ${target} messages`;
                
                if (percentage >= 100) {
                    this.elements.progressBar.style.background = 'linear-gradient(90deg, #228B22, #90EE90)';
                }
            }

            sendMessage(action, data = {}) {
                if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                    this.ws.send(JSON.stringify({ action, data }));
                } else {
                    this.log('error', 'WebSocket not connected');
                }
            }

            startCollection() {
                this.sendMessage('start');
                this.log('status', 'Starting data collection...');
            }

            stopCollection() {
                this.sendMessage('stop');
                this.log('status', 'Stopping data collection...');
            }

            resetCollection() {
                this.sendMessage('reset');
                this.log('status', 'Resetting connection and statistics...');
            }

            clearLog() {
                this.elements.logContainer.innerHTML = '';
                this.log('status', 'Log cleared');
            }

            log(type, message) {
                const entry = document.createElement('div');
                entry.className = `log-entry log-${type} fade-in`;
                
                const timestamp = new Date().toLocaleTimeString();
                entry.innerHTML = `
                    <span class="timestamp">${timestamp}</span>
                    <span>${message}</span>
                `;
                
                this.elements.logContainer.appendChild(entry);
                this.elements.logContainer.scrollTop = this.elements.logContainer.scrollHeight;
                
                // Keep only last 100 log entries
                while (this.elements.logContainer.children.length > 100) {
                    this.elements.logContainer.removeChild(this.elements.logContainer.firstChild);
                }
            }
        }

        // Initialize the monitor when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new AethericEngineMonitor();
        });
    </script>
</body>
</html>
